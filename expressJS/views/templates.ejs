<!DOCTYPE html>
<style>
  * {
    /*  border: 1px solid red;*/
  }
  html,
  body {
    height: 100%;
    width: 100%;
  }
  /*3 dives, mainBoxer, opponentBoxer,vs*/
  body {
    background-color: skyblue;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-evenly;
  }

  #container {
    display: flex;
    /* flex-wrap: wrap-reverse;*/
    justify-content: center;
    flex-direction: row;
    align-items: center;
    gap: 20px;
    position: absolute;
    font-size: 25px;
  }
  select {
    display: block;
    width: 100%;
    text-align: center;
    margin-top: 15px;
  }
  h3 {
    font-size: 40px;
  }

  #d1 {
    width: 35vw;
    /*order: 0;*/
  }
  #d2 {
    width: 35vw;
  }
  #imageOne {
    /* background-color: red;*/
  }
  #boxerOne {
    background: lightpink;
    width: 35vw;
    height: 35vw;
    border-radius: 50%;
    border-color: red;
    border-style: solid;
    object-fit: cover;
  }

  #opponentPicture {
    background: lightpink;
    width: 35vw;
    height: 35vw;
    border-radius: 50%;
    border-color: blue;
    border-style: solid;
    object-fit: cover;
  }
  #box {
    display: block;
    background-color: orange;
    margin-top: 500px;
    height: 25px;
    width: 200px;
  }
  #h3 {
    font-size: 400px;
  }

  /*d1,d2 have label text and dropdown*/
</style>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>List Of Middleweight Champions</title>
  </head>

  <body>
    <h1 style="color: black">MiddleWeight Fanatasy Matchup</h1>

    <div id="container">
      <div id="d1">
        <div id="imageOne">
          <img src="" id="boxerOne" />
        </div>

        <label id="get-label">
          select a boxer

          <select id="filters">
            <% for (boxerName of boxerNames){ %>
            <option value="<%=boxerName.id%>"><%=boxerName.name%></option>
            <% } %>
          </select>
        </label>
      </div>
      <div id="vs"><h2 style="color: black">VS</h2></div>
      <div id="d2">
        <div id="imageTwo">
          <img src="" id="opponentPicture" />
        </div>

        <label id="get-labelTwo">
          select an opponent

          <select id="opponents">
            <% for (boxerName of boxerNames){ %>
            <option value="<%=boxerName.id%>"><%=boxerName.name%></option>
            <% } %>
          </select>
        </label>
      </div>
    </div>
    <div id="d3">
      <button id="box">Box</button>
    </div>
    <h3 style="color: rgb(255, 77, 0)" id="winnerIs"></h3>
  </body>

  <script>
    const label = document.getElementById("get-label");

    const opponenetLabel = document.getElementById("get-labelTwo");
    const boxButton = document.getElementById("box");
    //console.log("fight!", boxButton);
    let mainBoxerName = document.getElementById("filters");
    let opponentBoxerName = document.getElementById("opponents");
    let mainBoxerText = null;
    let opponentBoxerText = null;

    function findSelectedBoxerName(dropdown) {
      var length = dropdown.children.length;

      for (var i = 0; i < length; i++) {
        if (dropdown.children[i].selected) {
          //challenge, how do I convert this into a
          return dropdown.children[i].text;
        }
      }
    }
    mainBoxerName.onchange = function () {
      mainBoxerText = findSelectedBoxerName(mainBoxerName);
    };

    opponentBoxerName.onchange = function () {
      opponentBoxerText = findSelectedBoxerName(opponentBoxerName);
    };

    label.onchange = () => displayImage("filters", "boxerOne");
    opponenetLabel.onchange = () =>
      displayImage("opponents", "opponentPicture");

    async function displayImage(dropDownId, imageId) {
      const dropdown = document.getElementById(dropDownId);

      let boxerId = parseInt(dropdown.value);

      const response = await fetch(
        `http://localhost:9000/api/boxers/${boxerId}/json`
      );

      const json = await response.json();
      const imageElement = document.getElementById(imageId);
      imageElement.src = "https://" + json.imageURL;
    }
    boxButton.onclick = async function () {
      let mainBoxerId = getBoxerId("filters");

      let opponentBoxerId = getBoxerId("opponents");

      const winnerResponse = await fetch(
        `/api/simulatefight/${mainBoxerId}/${opponentBoxerId}`
      );

      let winnerText = await winnerResponse.text();

      winnerIs.innerText = winnerText;

      //console.log(winnerText);
      //console.log("this is the main boxer dropdown", mainBoxerText);
      //console.log("This is opponent boxer dropdown", opponentBoxerText);

      if (winnerText === mainBoxerText) {
        displayOutcome("green", "red", winnerText + " " + "won");
      } else if (winnerText === opponentBoxerText) {
        displayOutcome("red", "green", winnerText + " " + "won");
      } else {
        displayOutcome("yellow", "yellow", "it's a draw");
      }
    };

    function displayOutcome(colorOne, colorTwo, outcomeText) {
      document.getElementById("imageOne").style.background = colorOne;
      document.getElementById("imageTwo").style.background = colorTwo;
      winnerIs.innerText = outcomeText;
    }

    function getBoxerId(dropDownId) {
      const dropdown = document.getElementById(dropDownId);

      let boxerId = parseInt(dropdown.value);

      return boxerId;
    }
  </script>
  <!--
   1) Make the button bigger and put a bell icon 
   2) image has to be centered and in a cirlce 
   3) Drowpdown and text must fit screen when I expand 
   4) Style the heading
  -->
</html>
